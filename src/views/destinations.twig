{% if user %}
  <p style="color: green">‚úî Utilisateur connect√© : {{ user.name ?? 'Inconnu' }}</p>
{% else %}
  <p style="color: red">‚ùå Aucun utilisateur connect√©</p>
{% endif %}


{% extends "base.twig" %}

{% block title %}{{ destination.titre }} - {{ destination.pays }}{% endblock %}

{% block style %}
  <link rel="stylesheet" href="/assets/css/destinations.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
{% endblock %}

{% block main %}

{# ‚úÖ Corrige le chemin de l'image principale #}
{% set mainImagePath = destination.imagePrincipale starts with '/uploads/' ? destination.imagePrincipale : '/uploads/' ~ destination.imagePrincipale %}

<div class="banner">
  <img src="{{ mainImagePath }}" alt="Image de {{ destination.titre }}">
  <div class="banner-overlay">
    <div class="banner-content">
      <h1 class="destination-title">{{ destination.titre }}</h1>
      <p class="destination-country">{{ destination.pays }}</p>
      <form method="POST" action="/checklist/{{ destination.id }}">
  <button class="add-trip-btn" type="submit">Ajouter ce voyage</button>
</form>

    </div>
  </div>
</div>

<div class="destination-sections">
  {% for section in destination.sections %}
    <section class="section section-{{ section.type | lower }}">
      <h2>{{ section.titre }}</h2>
      <p>{{ section.contenu }}</p>

      {# ‚úÖ Affichage des images li√©es √† cette section #}
      {% if section.images.length > 0 %}
        <div class="section-images">
          {% for image in section.images %}
            {% set imgPath = image.url starts with '/uploads/' ? image.url : '/uploads/' ~ image.url %}
            <img src="{{ imgPath }}" alt="Image de la section {{ section.titre }}">
          {% endfor %}
        </div>
      {% endif %}

      {# ‚úÖ Liste simple de bullet points #}
      {% if section.bulletPoints.length > 0 %}
        <ul class="bullet-list">
          {% for bullet in section.bulletPoints %}
            <li>{{ bullet.contenu }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {# ‚úÖ Groupes de bullet points #}
      {% if section.groupedPoints.length > 0 %}
        <div class="grouped-bullets">
          {% for group in section.groupedPoints %}
            <h4>{{ group.titre }}</h4>
            <ul>
              {% for point in group.contents %}
                <li>{{ point.contenu }}</li>
              {% endfor %}
            </ul>
          {% endfor %}
        </div>
      {% endif %}
    </section>
  {% endfor %}
</div>
<hr style="margin-top: 3rem; margin-bottom: 2rem;">

<section class="last-reviews">
  <h2>Derniers avis</h2>

  <a href="/destination/{{ destination.id }}/reviews" 
     style="display: inline-block; margin-bottom: 1em; padding: 0.5em 1em; background:#28a745; color:white; border-radius:4px; text-decoration:none;">
    Ajouter un commentaire
  </a>

  {% if lastTwoReviews is empty %}
    <p>Aucun avis pour cette destination.</p>
  {% else %}
    <ul>
      {% for review in lastTwoReviews %}
        <li style="border: 1px solid #ccc; padding: 1em; margin-bottom: 1em;">
          <div style="display: flex; align-items: center; gap: 1em; margin-bottom: 0.5em;">
            <img
              src="/uploads/{{ review.user.avatar ?: 'default-avatar.png' }}"
              alt="{{ review.user.prenom }} {{ review.user.nom }}"
              width="40" height="40"
              style="border-radius: 50%; object-fit: cover;"
            />
            <strong>{{ review.user.prenom }} {{ review.user.nom }}</strong>
            <span> - Note : {{ review.rating }} / 5</span>
          </div>
          <p>{{ review.content }}</p>
          <p>üëç {{ review.likes|length }} like{{ review.likes|length > 1 ? 's' : '' }}</p>
        </li>
      {% endfor %}
    </ul>

    <a href="/destination/{{ destination.id }}/reviews" style="font-weight: bold;">
      Voir tous les avis &rarr;
    </a>
  {% endif %}
</section>




{% endblock %}
