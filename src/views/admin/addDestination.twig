{% extends "base.twig" %}

{% block style %}
  <link rel="stylesheet" href="/assets/css/destinationForm.css">
{% endblock %}

{% block title %}Ajouter une destination{% endblock %}

{% block main %}
<h1>Ajouter une nouvelle destination</h1>

<form method="POST" action="/admin/destinations/add" enctype="multipart/form-data" id="destination-form">
  <label>Continent :</label>
  <select name="continent" required>
    <option value="">-- S√©lectionner un continent --</option>
    <option value="Afrique">Afrique</option>
    <option value="Am√©rique du Nord">Am√©rique du Nord</option>
    <option value="Am√©rique du Sud">Am√©rique du Sud</option>
    <option value="Asie">Asie</option>
    <option value="Europe">Europe</option>
    <option value="Oc√©anie">Oc√©anie</option>
    <option value="Antarctique">Antarctique</option>
  </select>

  <label>Titre :</label>
  <input type="text" name="titre" required>

  <label>Pays :</label>
  <input type="text" name="pays" required>

  <label for="description">Description :</label>
  <textarea id="description" name="description" required></textarea>

  <label>Image principale :</label>
  <input type="file" name="imagePrincipale" accept="image/*" required>

  <hr>

  <h2>Sections dynamiques</h2>
  <div id="sections-container"></div>

  <button type="button" onclick="addSection()">‚ûï Ajouter une section</button>
  <br><br>
  <button type="submit">‚úÖ Enregistrer la destination</button>
</form>

<script>
  let sectionIndex = 0;

  function addSection() {
    const container = document.getElementById('sections-container');
    const section = document.createElement('div');
    section.className = 'section-block';

    section.innerHTML = `
      <label>Titre de la section :</label>
      <input type="text" name="sections[${sectionIndex}][titre]" required>

      <label>Type de section :</label>
      <input type="text" name="sections[${sectionIndex}][type]" placeholder="ex: Guide complet" required>

      <div class="sub-content" id="contents-${sectionIndex}">
        <h4>Contenus (bullet points, paragraphes‚Ä¶)</h4>
      </div>
      <button type="button" onclick="addContent(${sectionIndex})">‚ûï Ajouter contenu</button>

      <div class="subsection-wrapper" id="subsections-${sectionIndex}">
        <h4>Sous-sections</h4>
      </div>
      <button type="button" onclick="addSubsection(${sectionIndex})">‚ûï Ajouter une sous-section</button>

      <div class="sub-content" id="images-${sectionIndex}">
        <h4>Images (facultatives)</h4>
      </div>
      <button type="button" onclick="addImage(${sectionIndex})">‚ûï Ajouter image</button>

      <button type="button" class="delete-section-btn" onclick="this.closest('.section-block').remove()">‚ùå Supprimer cette section</button>
      <hr>
    `;

    container.appendChild(section);
    sectionIndex++;
  }

  function addContent(sectionId) {
    const contentContainer = document.getElementById(`contents-${sectionId}`);
    const textarea = document.createElement('textarea');
    textarea.name = `sections[${sectionId}][contenus][]`;
    textarea.rows = 3;
    textarea.placeholder = "Contenu (paragraphe ou point)";
    textarea.required = true;
    contentContainer.appendChild(textarea);
  }

  function addImage(sectionId) {
    const imageContainer = document.getElementById(`images-${sectionId}`);
    const input = document.createElement('input');
    input.type = 'file';
    input.name = `sections[${sectionId}][images][]`;
    input.accept = 'image/*';
    imageContainer.appendChild(input);
  }

  function addSubsection(sectionIndex) {
    const wrapper = document.getElementById(`subsections-${sectionIndex}`);
    const subsectionIndex = wrapper.querySelectorAll('.subsection-block').length;

    const container = document.createElement('div');
    container.className = 'subsection-block';
    container.innerHTML = `
      <label>üìù Mini sous-titre :</label>
      <input type="text" name="sections[${sectionIndex}][subsections][${subsectionIndex}][titre]" required>

      <div class="sub-content">
        <h4>Contenus :</h4>
        <div id="subcontents-${sectionIndex}-${subsectionIndex}"></div>
        <button type="button" onclick="addSubContent(${sectionIndex}, ${subsectionIndex})">‚ûï Ajouter contenu</button>
      </div>
    `;
    wrapper.appendChild(container);
  }

  function addSubContent(sectionIndex, subsectionIndex) {
    const container = document.getElementById(`subcontents-${sectionIndex}-${subsectionIndex}`);
    const textarea = document.createElement('textarea');
    textarea.name = `sections[${sectionIndex}][subsections][${subsectionIndex}][contents][]`;
    textarea.rows = 2;
    textarea.required = true;
    textarea.placeholder = "Contenu de la sous-section";
    container.appendChild(textarea);
  }
</script>
{% endblock %}
